<html>
    <head>
        <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.5.4/dist/aframe-extras.min.js"></script>
        
    <script>
AFRAME.registerComponent('removing', {
  init: function () {
    const el = this.el;

    el.addEventListener('click', () => {
      if (el.classList.contains('chicken')) {
        const savedCount = document.querySelectorAll('[data-saved="true"]').length;

        // Κεντρική θέση που θέλεις
        const baseX = 5;
        const baseZ = 10;

        // Απλή διάταξη σε grid (π.χ. 5 σε κάθε σειρά)
        const rowLength = 5;
        const spacing = 1.5;

        const row = Math.floor(savedCount / rowLength);
        const col = savedCount % rowLength;

        // Προσθέτουμε τυχαίο offset έως ±0.5 για πιο φυσική εμφάνιση
        const randomOffsetX = (Math.random() - 0.5);
        const randomOffsetZ = (Math.random() - 0.5);

        el.setAttribute('position', { 
          x: baseX + col * spacing + randomOffsetX,
          y: 0,
          z: baseZ + row * spacing + randomOffsetZ
        });

        el.setAttribute('random-walk', 'speed: 0');
        el.removeAttribute('animation-mixer'); // σταματά το animation
        el.setAttribute('data-saved', 'true');
      }
    });
  }
});
</script>
        
    <style>
        h1 { text-align: center; }
        h3 { text-align: center; }
        a-scene { width: 50%; height: 50%; border: dotted RosyBrown 5px; }
    </style>
</head>
<body>
    <h1>Chicken Run</h1>
    <h3>Σοφία Κόντη</h3>
    <hr />
    <P><strong>The little chicks have escaped and are hiding somewhere in the forest! Track them down and make sure every one of them gets safely back to the coop.</strong>...</P>
    <hr />
    <div align="center">

  <!-- Scene -->
          <a-scene id="s1" cursor="rayOrigin: mouse" background="color:LightBlue" shadow="type: pcfsoft" ondblclick="this.requestFullscreen();"embedded>
          <a-plane color="DarkOliveGreen" height="500" width="500" rotation="-90 0 0" metalness="0" shadow></a-plane>
          <a-sphere color="GoldenRod" radius="500" position="0 5000 0" material="fog: false"></a-sphere>

<!-- Assets -->      
             <a-assets>
              <a-asset-item id="spruce_tree" src="spruce_tree.glb"></a-asset-item>
              <a-asset-item id="little_farmhouse" src="little_farmhouse.glb"></a-asset-item>
              <a-asset-item id="colored_flower" src="colored_flower.glb"></a-asset-item>
              <a-asset-item id="baby_chicken" src="baby_chicken.glb"></a-asset-item>
              </a-assets>
<!-- Camera -->        
          <a-camera> <a-cursor fuse="true" fuse-timeout="5000"></a-cursor></a-camera>

<!-- Lights -->      
          <a-light type="ambient" color="#556677" intensity="0.7"></a-light>
          <a-light type="directional" color="#ffddaa" intensity="1.2" position="10 15 10" cast-shadow="true"></a-light>
        
         <a-entity gltf-model="#little_farmhouse" scale="0.2 0.2 0.2" position="1 1.1 1"></a-entity>
        </a-scene>
    </div>

    
<script>  
// Component για έλεγχο αν η κάμερα κοιτάει κοτόπουλο

    
  AFRAME.registerComponent('random-walk', {
    schema: {
      speed: { type: 'number', default: 0.5 },
      range: { type: 'number', default: 10 }
    },
    init: function () {
      this.target = new THREE.Vector3();
      this.chooseNewTarget();
    },
    tick: function (time, delta) {
      const el = this.el.object3D;
      const pos = el.position;
      const dir = new THREE.Vector3().subVectors(this.target, pos);
      const dist = dir.length();

      if (dist < 0.1) {
        this.chooseNewTarget();
      } else {
        dir.normalize();
        el.position.addScaledVector(dir, this.data.speed * delta / 1000);
        el.lookAt(this.target);
      }
    },
    chooseNewTarget: function () {
      const current = this.el.object3D.position;
      const x = current.x + (Math.random() * this.data.range - this.data.range / 2);
      const z = current.z + (Math.random() * this.data.range - this.data.range / 2);
      this.target.set(x, current.y, z);
    }
  });

window.addEventListener('load', () => {
  const scene1 = document.getElementById('s1');

  for (let i = 0; i < 10; i++) {
    const chicken = document.createElement('a-entity');
    const x = Math.random() * 20 - 10;
    const z = Math.random() * 20 - 10;

    chicken.setAttribute('gltf-model', '#baby_chicken');
    chicken.setAttribute('class', 'chicken');
    chicken.setAttribute('position', x + ' 0 ' + z);
    chicken.setAttribute('scale', '0.1 0.1 0.1');
    chicken.setAttribute('animation-mixer', 'clip: *; loop: repeat');
    chicken.setAttribute('random-walk', 'speed: 0.5; range: 5');
    chicken.setAttribute('removing', '');
    chicken.setAttribute('geometry', 'primitive: box');
    chicken.setAttribute('material', 'opacity: 0; transparent: true');

    scene1.appendChild(chicken);
  }
});
    
    // ΕΔΩ ΔΗΜΙΟΥΡΓΩ ΠΟΛΛΑΠΛΑ ΑΝΤΙΓΡΑΦΑ ΜΙΑΣ ΟΝΤΟΤΗΤΑΣ
        var scene1 = document.getElementById('s1');
        for(var i = 0; i < 400; i++) {
        var tree = document.createElement('a-entity');
        var x = Math.random() * 400 - 200;
        var z = Math.random() * 400 - 200;
        var s = 0.01;
        var r = Math.random() * 180 - 90;
        tree.setAttribute('gltf-model', '#spruce_tree');
        tree.setAttribute('position', x + ' 0 ' + z);
        tree.setAttribute('scale', s + ' ' + s + ' ' + s);
        tree.setAttribute('rotation', '0 ' + r + ' 0');
        scene1.appendChild(tree);
      }
      for (var i = 0; i < 200; i++) {
      var flowers = document.createElement('a-entity');
      var x = Math.random() * 400 - 200;
      var z = Math.random() * 400 - 200;
      var s = 0.03;
      var r = Math.random() * 180 - 90;
      flowers.setAttribute('gltf-model', '#colored_flower');
      flowers.setAttribute('position', x + ' 0 ' + z);
      flowers.setAttribute('scale', s + ' ' + s + ' ' + s);
      flowers.setAttribute('rotation', '0 ' + r + ' 0');
      flowers.setAttribute('shadow', 'receive: false');  
      scene1.appendChild(flowers);
      }
    </script>
    <hr />
    <p><strong>Οδηγίες:</strong>...</p>
    <hr />
    <p><strong>Credits:</strong></p>
</body>
</html>
